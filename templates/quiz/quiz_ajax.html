{% extends "base.html" %}
{% block title %}Quiz â€“ {{ language }}{% endblock %}

{% block content %}
<h1>{{ language | capitalize }} Quiz</h1>

<div id="quiz-box">
    Loading...
</div>

<script>
// Use the questions passed from Flask directly
let questions = {{ questions|tojson }};
let currentIndex = 0;
let score = 0;

function showQuestion() {
    if (currentIndex >= questions.length) {
        document.getElementById("quiz-box").innerHTML = `
            <h2>Quiz Finished!</h2>
            <p>Your Score: ${score} / ${questions.length}</p>
            <a href="{{ url_for('home') }}" class="btn">Back to Home</a>
        `;
        return;
    }

    const q = questions[currentIndex];
    let html = `
        <h2>Question ${currentIndex + 1} / ${questions.length}</h2>
        <p>${q.question}</p>
        <ul>
    `;

    q.options.forEach(opt => {
        html += `<li><button onclick="submitAnswer('${opt}', '${q.answer}')">${opt}</button></li>`;
    });

    html += `</ul>`;
    document.getElementById("quiz-box").innerHTML = html;
}

function submitAnswer(selected, correct) {
    // Update score
    if (selected === correct) score++;

    // Show explanation
    const explanation = `The correct answer is: ${correct}`;
    document.getElementById("quiz-box").innerHTML = `
        <h2>${selected === correct ? "Correct!" : "Incorrect!"}</h2>
        <p>${explanation}</p>
        <button onclick="nextQuestion()">Next Question</button>
    `;
}

function nextQuestion() {
    currentIndex++;
    showQuestion();
}

// Start quiz
document.addEventListener("DOMContentLoaded", showQuestion);
</script>
{% endblock %}