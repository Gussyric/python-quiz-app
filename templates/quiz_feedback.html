<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz App - {{ language|capitalize }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
{% if finished %}
    <div class="container">
        <h1>Quiz Completed!</h1>
        <p class="score">Your score: {{ score }} / {{ total }}</p>
        <a href="{{ url_for('home') }}"><button>Back to Home</button></a>
    </div>
{% else %}
    <div class="container">
        <h1>Quiz: {{ language }}</h1>
        
        <div class="progress-container">
            <div class="progress-bar" style="width: {{ (question_number / total_questions) * 100 }}%;"></div>
        </div>
        <p>Question {{ question_number }} of {{ total_questions }}</p>

        {% if show_feedback %}
            <div class="feedback">
                <p class="{{ 'correct' if is_correct else 'incorrect' }}">
                    <strong>{{ feedback_msg }}</strong>
                </p>

                {% if question.explanation %}
                    <p class="explanation"><em>{{ question.explanation }}</em></p>
                {% endif %}

                <!-- Options Review with Smart Wrong Explanations -->
                <div class="options-review">
                    {% for opt in options %}
                        {% if opt == correct %}
                            <div class="option correct">
                                <strong>{{ opt }}</strong> — Correct answer
                            </div>

                        {% elif opt == selected %}
                            <div class="option incorrect">
                                <strong>{{ opt }}</strong> (Your choice)<br>
                                <span class="wrong-explanation">
                                    {% if question.wrong_explanations and opt in question.wrong_explanations %}
                                        {{ question.wrong_explanations[opt] }}
                                    {% else %}
                                        This is not the correct answer.
                                    {% endif %}
                                </span>
                            </div>

                        {% elif question.wrong_explanations and opt in question.wrong_explanations %}
                            <div class="option">
                                {{ opt }}<br>
                                <small class="wrong-explanation-dim">
                                    {{ question.wrong_explanations[opt] }}
                                </small>
                            </div>

                        {% else %}
                            <div class="option">{{ opt }}</div>
                        {% endif %}
                    {% endfor %}
                </div>

                <form method="POST">
                    <button type="submit" name="next_question" class="next-btn">
                        {% if question_number == total_questions %}
                            Finish Quiz
                        {% else %}
                            Next Question →
                        {% endif %}
                    </button>
                </form>
            </div>

        {% else %}
            <!-- Question Display -->
            <form method="POST" class="quiz-form">
                <p class="question"><strong>{{ question.question }}</strong></p>
                
                {% for opt in options %}
                    <label class="option-label">
                        <input type="radio" name="option" value="{{ opt }}" required>
                        {{ opt }}
                    </label>
                {% endfor %}
                
                <br>
                <button type="submit" class="submit-btn">Submit Answer</button>
            </form>
        {% endif %}

        <div class="fixed-bottom">
            <a href="{{ url_for('home') }}"><button>← Back to Home</button></a>
        </div>
    </div>
{% endif %}
</body>
</html>