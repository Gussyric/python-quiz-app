<!DOCTYPE html>
<html>
<head>
    <title>Quiz App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1 style="text-align:center;">Quiz</h1>

    <div id="quiz-container" style="max-width: 600px; margin: auto;">
        <div id="question-box"></div>
        <div id="options-box"></div>
        <div id="feedback-box"></div>

        <button id="submit-btn" style="display:none;">Submit Answer</button>
        <button id="next-btn" style="display:none;">Next Question</button>

        <div style="margin-top:20px; text-align:center;">
            <a href="{{ url_for('home') }}"><button>Back to Home</button></a>
        </div>
    </div>

<script>
let currentQuestion = {};
let selectedOption = null;

async function loadQuestion() {
    // Hide buttons initially
    document.getElementById('submit-btn').style.display = 'none';
    document.getElementById('next-btn').style.display = 'none';
    document.getElementById('feedback-box').innerHTML = '';

    const language = "{{ language }}";
    const res = await fetch(`/quiz/${language}/get_question`);
    const data = await res.json();

    if (data.finished) {
        document.getElementById('question-box').innerHTML = `<h2>Quiz Finished!</h2><p>Your score: ${data.score} / ${data.total}</p>`;
        document.getElementById('options-box').innerHTML = '';
        return;
    }

    currentQuestion = data;

    // Render question
    document.getElementById('question-box').innerHTML = `<h3>Question ${data.question_number}/${data.total_questions}:</h3><p>${data.question}</p>`;

    // Render options
    const optionsBox = document.getElementById('options-box');
    optionsBox.innerHTML = '';
    data.options.forEach(opt => {
        const div = document.createElement('div');
        div.className = 'option';
        div.innerHTML = `<input type="radio" name="option" value="${opt}"> ${opt}`;
        optionsBox.appendChild(div);
    });

    document.getElementById('submit-btn').style.display = 'inline-block';
}

// Submit Answer
document.getElementById('submit-btn').addEventListener('click', async () => {
    const radios = document.querySelectorAll('input[name="option"]');
    selectedOption = null;
    radios.forEach(r => { if(r.checked) selectedOption = r.value; });

    if (!selectedOption) {
        alert("Please select an option!");
        return;
    }

    const language = "{{ language }}";
    const res = await fetch(`/quiz/${language}/answer`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ selected: selectedOption })
    });

    const data = await res.json();

    // Show feedback
    let fbHTML = `<p><strong>${data.feedback_msg}</strong></p>`;
    fbHTML += `<p><em>${data.explanation}</em></p>`;
    document.getElementById('feedback-box').innerHTML = fbHTML;

    // Highlight options
    const optionsDivs = document.querySelectorAll('.option');
    optionsDivs.forEach(div => {
        const text = div.textContent.trim();
        if (text === data.correct) div.style.backgroundColor = "#4CAF50";
        if (text === selectedOption && selectedOption !== data.correct) div.style.backgroundColor = "#f44336";
    });

    // Hide Submit, show Next
    document.getElementById('submit-btn').style.display = 'none';
    document.getElementById('next-btn').style.display = 'inline-block';
});

// Next Question
document.getElementById('next-btn').addEventListener('click', () => {
    loadQuestion();
});

window.onload = loadQuestion;
</script>
</body>
</html>